var oe=Object.defineProperty,le=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var W=(a,n,t)=>n in a?oe(a,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[n]=t,J=(a,n)=>{for(var t in n||(n={}))ue.call(n,t)&&W(a,t,n[t]);if(j)for(var t of j(n))re.call(n,t)&&W(a,t,n[t]);return a},G=(a,n)=>le(a,se(n));import{aq as te,aA as ie,r,a5 as ce,am as de,aI as _e,a as b,o as C,c as k,f as o,w as p,e as c,i as e,S as X,Y as E,F as z,g as Y,aa as K,t as I,X as x,h as Q,ac as pe,_ as N,aE as me,aD as ge,ab as ve,v as fe,a0 as he}from"./vendor.81235092.js";import{b as Ce,c as ae,d as ye}from"./article.2c8b037a.js";import{d as ke}from"./dayjs.min.c35ffde2.js";import{a as De,C as Be}from"./CpnLoadMore.e0d82878.js";import{_ as $}from"./CpnBlockCard.d4aaff98.js";import{u as Ie,_ as R}from"./index.1e91d38a.js";import{C as $e}from"./CpnNavList.112045c1.js";import"./base.efe1ff67.js";function xe(){const a=te(),n=ie(),{articleId:t}=n.params,d=r(0),_=r(0),m=r("..."),f=r("..."),h=r("..."),g=r("...");async function i(){a.start();const l=await Ce(parseInt(t));a.finish(),d.value=l.tag,_.value=l.likeCount||0,f.value=l.authorName,h.value=l.createTime,g.value=l.title,m.value=l.content}return i(),{content:m,tag:d,likeCount:_,authorName:f,createTime:h,title:g,articleId:t}}function we(a){const n=r(null),t=r([]),d=r(null);function _(){var i;const f=(i=n.value)==null?void 0:i.$el.querySelectorAll("h1,h2,h3,h4,h5,h6"),h=Array.from(f).filter(l=>!!l.innerText.trim());if(!h.length)return;const g=Array.from(new Set(h.map(l=>l.tagName))).sort();t.value=h.map(l=>({title:l.innerText,lineIndex:l.getAttribute("data-v-md-line"),indent:g.indexOf(l.tagName)}))}function m(f){var l;const{lineIndex:h}=f,i=((l=n.value)==null?void 0:l.$el).querySelector(`[data-v-md-line="${h}"]`);i&&i.scrollIntoView()}return ce(a,()=>{a.value.length&&a.value!=="..."&&de(()=>{_()})}),{preview:n,titles:t,detailWrapper:d,handleAnchorClick:m}}function Fe(a){const n=Number(a||0),t=te(),d=r(0),_=r(1),m=r([]);async function f(i,l=5){t.start();const{commentCount:y,commentList:D}=await ae({articleId:n,page:i});t.finish(),D.map(B=>{B.gmtCreate=ke().format("YYYY MM DD"),B.currentPage=1,B._isOpen=!1}),m.value=D,d.value=Math.ceil(y/l)}function h(){f(1)}function g(i){_.value=i,f(i)}return _e(()=>{f(1)}),{totalPage:d,currentPage:_,currentList:m,onCommentUpdate:h,changeCurrentPage:g}}var Z="/assets/default-avatar.5bc6a5fa.png";const ee="\u8F93\u5165\u56DE\u590D\u7684\u5185\u5BB9";function Pe(a,n){const t=r(""),d=r(""),_=r(-1),m=r(-1),h=Ie().userId,g=r(!1),i=r(ee),l=r(!1),y=r(-1),D=r(new Map),B=r(!1),w=r();async function F(u=!1){g.value=!0;const v={content:u?d.value:t.value,parentId:_.value,commenterId:h,articleId:a,commentedId:m.value,rootId:y.value};await ye(v)&&(t.value="",d.value="",l.value=!1,u&&P(1)),g.value=!1}async function P(u=1){var L;B.value=!0;const{commentList:v}=await ae({articleId:a,page:u,rootId:y.value});B.value=!1,D.value.has(y.value)||D.value.set(y.value,new Map),(L=D.value.get(y.value))==null||L.set(u,v)}function T(u,v,{nick:L,userId:ne}){y.value=v,l.value=!0,_.value=u,m.value=ne,i.value=`\u56DE\u590D ${L} :`}function U(){_.value=-1,m.value=-1,i.value=ee,d.value=""}async function A(){await F(!0)}async function V(){_.value=-1,y.value=-1,await F(),n("onCommentUpdate")}function H(u){t.value=u}function s(u){d.value=u}function S(u){n("changeCurrentPage",u)}function M(u){w.value.currentPage=u,y.value=w.value.id,P(u)}function O(u){_.value=u.id,y.value=u.id,P(),u._isOpen=!u._isOpen}function q(u){w.value=u}return{content:t,parentId:_,loading:g,replyLoading:B,modalShow:l,replyPlaceHolder:i,replyContent:d,replyList:D,replyHandle:A,commentHandle:V,changeCommentValue:H,changeCurrentPage:S,changeReplyHandle:O,changeReplyValue:s,replyOpenHandle:T,replyCloseHandle:U,getReplyList:P,pageChangeHandle:M,changeCurrentTarget:q}}const Ae={class:"comment-list"},Ee={class:"comment-area"},Le=x("\u8BC4\u8BBA"),Ue={class:"comment-item-header"},He={class:"header-info"},Ne={class:"username"},be={class:"floor"},Re={class:"comment-item-main"},Te={class:"comment-item-footer"},Ve=["onClickCapture"],Se={class:"reply-list-main"},Me=["onClick"],Oe={class:"username"},qe={class:"content"},ze={key:1,class:"main-item"},Ye={key:2,class:"main-item"},je=x("\u6211\u6709\u8BDD\u8BF4 \u{1F603}"),We={class:"reply-modal"},Je={class:"modal-main"},Ge=x("\u53D1\u8868\u56DE\u590D"),Xe=b({props:{currentPage:null,totalPage:null,currentList:null,articleId:null},emits:["onCommentUpdate","changeCurrentPage"],setup(a,{emit:n}){const t=a,{loading:d,content:_,modalShow:m,replyContent:f,replyPlaceHolder:h,replyList:g,replyLoading:i,replyHandle:l,commentHandle:y,changeCommentValue:D,changeCurrentPage:B,changeReplyHandle:w,replyOpenHandle:F,replyCloseHandle:P,changeReplyValue:T,pageChangeHandle:U,changeCurrentTarget:A}=Pe(parseInt(t.articleId),n);return(V,H)=>(C(),k("ul",Ae,[o(e($),{title:"\u8BC4\u8BBA \u{1F4AD}","can-hover":!0},{default:p(()=>[c("div",Ee,[o(e(X),{value:e(_),placeholder:"\u8F93\u5165\u8BC4\u8BBA\u7684\u5185\u5BB9",type:"textarea",autosize:{maxRows:6,minRows:1},maxlength:500,"show-count":"",clearable:"",onUpdateValue:e(D)},null,8,["value","onUpdateValue"]),o(e(E),{secondary:"",type:"success",loading:e(d),disabled:e(d),style:{width:"5rem","align-self":"flex-end"},onClick:e(y)},{default:p(()=>[Le]),_:1},8,["loading","disabled","onClick"])])]),_:1}),(C(!0),k(z,null,Y(t.currentList,s=>(C(),k("div",{key:s.id,class:"comment-item"},[o(e($),{style:{padding:"1rem"},class:"comment-item","can-hover":!0},{default:p(()=>{var S,M,O,q,u;return[c("div",Ue,[o(e(K),{size:50,"object-fit":"cover",src:s.commentUserInfo.imgUrl||e(Z)},null,8,["src"]),c("div",He,[c("span",Ne,I(s.commentUserInfo.nick||"\u4F5A\u540D"),1),c("span",be,I(`${s.gmtCreate}`),1)])]),c("div",Re,I(s.content||"..."),1),c("div",Te,[o(e(E),{type:"warning",quaternary:"",onClick:v=>e(w)(s)},{default:p(()=>[x(I(`\u{1F4AC} ${s.commentCount||0} `),1)]),_:2},1032,["onClick"]),o(e(E),{type:"error",quaternary:""},{default:p(()=>[x(I(`\u{1F60D} ${s.likeCount}`),1)]),_:2},1024)]),s._isOpen?(C(),k("div",{key:0,class:"comment-reply-list",onClickCapture:v=>e(A)(s)},[c("ul",Se,[(C(!0),k(z,null,Y((S=e(g).get(s.id))==null?void 0:S.get(s.currentPage),v=>(C(),k("li",{key:v.id,class:"main-item",onClick:L=>e(F)(v.id,s.id,v.commentUserInfo)},[o(e(K),{size:30,"object-fit":"cover",src:v.commentUserInfo.imgUrl||e(Z)},null,8,["src"]),c("span",Oe,I(`${v.commentUserInfo.nick||"\u4F5A\u540D"}${v.parentId===-1?"":` \u56DE\u590D ${v.commentedUserInfo.nick}`} : `),1),c("span",qe,I(v.content||"..."),1)],8,Me))),128)),!e(i)&&Math.ceil(s.commentCount/5)>1?(C(),Q(e(pe),{key:0,style:{"padding-left":"0.5rem","margin-top":"0.5rem"},page:s.currentPage,"page-count":Math.ceil(s.commentCount/5),"on-update:page":e(U)},null,8,["page","page-count","on-update:page"])):N("",!0),e(i)&&!((O=(M=e(g).get(s.id))==null?void 0:M.get(s.currentPage))!=null&&O.length)?(C(),k("li",ze," \u8BC4\u8BBA\u52A0\u8F7D\u4E2D ... ")):N("",!0),!e(i)&&!((u=(q=e(g).get(s.id))==null?void 0:q.get(s.currentPage))!=null&&u.length)?(C(),k("li",Ye," \u6682\u65E0\u56DE\u590D\uFF0C\u5FEB\u6765\u53D1\u8868\u4F60\u7684\u770B\u6CD5\u5427~ \u{1F601} ")):N("",!0)]),o(e(E),{type:"default",style:{width:"8rem","align-self":"flex-end"},onClick:v=>e(F)(-1,s.id,s.commentUserInfo)},{default:p(()=>[je]),_:2},1032,["onClick"])],40,Ve)):N("",!0)]}),_:2},1024)]))),128)),o(e(ge),{show:e(m),"onUpdate:show":H[0]||(H[0]=s=>me(m)?m.value=s:null),onAfterLeave:e(P)},{default:p(()=>[c("div",We,[o(e($),{title:"\u56DE\u590D"},{default:p(()=>[c("div",Je,[o(e(X),{placeholder:e(h),type:"textarea",autosize:{maxRows:6,minRows:6},maxlength:500,"show-count":"",value:e(f),onUpdateValue:e(T)},null,8,["placeholder","value","onUpdateValue"]),o(e(E),{type:"primary",style:{width:"8rem","align-self":"flex-end"},onClick:e(l)},{default:p(()=>[Ge]),_:1},8,["onClick"])])]),_:1})])]),_:1},8,["show","onAfterLeave"]),a.currentList.length?(C(),Q(e(De),{key:0,"current-page":a.currentPage,"total-page":a.totalPage,onChangeCurrentPage:e(B)},null,8,["current-page","total-page","onChangeCurrentPage"])):N("",!0)]))}});var Ke=R(Xe,[["__scopeId","data-v-6efa7550"]]);const Qe={class:"detail-command"},Ze=b({setup(a){return(n,t)=>(C(),k("div",Qe,[o(e($),{title:"\u76F8\u5173\u63A8\u8350 \u{1F600}"},{default:p(()=>[o(e($e))]),_:1})]))}});var et=R(Ze,[["__scopeId","data-v-58239e1a"]]);const tt={class:"detail-interact"},at={class:"detail-interact-button"},nt=x("\u597D\u6587 \u{1F60D}"),ot=x("\u6C34\u6587 \u{1F44E} "),lt=b({setup(a){return(n,t)=>(C(),k("div",tt,[o(e($),{title:"\u64CD\u4F5C \u{1F4A6}"},{default:p(()=>[c("div",at,[o(e(E),{type:"error"},{default:p(()=>[nt]),_:1}),o(e(E),{type:"primary"},{default:p(()=>[ot]),_:1})])]),_:1})]))}});var st=R(lt,[["__scopeId","data-v-3dae7fd8"]]);const ut={class:"detail-info"},rt={class:"detail-info-list"},it={class:"detail-info-author"},ct={class:"detail-info-time"},dt={class:"detail-info-tags"},_t=b({props:{tag:null,author:null,time:null},setup(a){const n=a,t=[{title:"\u5B66\u4E60",color:"primary"},{title:"\u751F\u6D3B",color:"info"},{title:"\u5410\u69FD",color:"warning"},{title:"\u6811\u6D1E",color:"error"}];return(d,_)=>(C(),k("div",ut,[o(e($),{title:"\u5173\u4E8E"},{default:p(()=>[c("div",rt,[c("div",it,I(`\u4F5C\u8005 - ${n.author}`),1),c("div",ct,I(`\u53D1\u5E03\u65F6\u95F4 - ${n.time}`),1),c("div",dt,[o(e(ve),{type:t[a.tag].color},{default:p(()=>[x(I(t[a.tag].title),1)]),_:1},8,["type"])])])]),_:1})]))}});var pt=R(_t,[["__scopeId","data-v-52ba0a8d"]]);const mt={class:"detail"},gt={class:"detail-main"},vt={class:"detail-catalogue"},ft={class:"catalogue"},ht=["onClick"],Ct={style:{cursor:"pointer"}},yt={name:"PageDetail"},kt=b(G(J({},yt),{setup(a){const{content:n,title:t,authorName:d,createTime:_,tag:m,articleId:f}=xe(),{preview:h,detailWrapper:g,titles:i,handleAnchorClick:l}=we(n),{totalPage:y,currentPage:D,currentList:B,onCommentUpdate:w,changeCurrentPage:F}=Fe(f);return(P,T)=>{const U=fe("v-md-editor");return C(),k("div",mt,[o(e(Be),{ref_key:"detailWrapper",ref:g},{leftBox:p(()=>[c("div",gt,[o(e($),{title:e(t)||"\u5185\u5BB9\u8BE6\u60C5 \u{1F4D6}",style:{"min-height":"90vh"},"can-hover":!0},{default:p(()=>[o(U,{ref_key:"preview",ref:h,"model-value":e(n),mode:"preview"},null,8,["model-value"])]),_:1},8,["title"]),o(e(Ke),{"article-id":e(f),"current-list":e(B),"current-page":e(D),"total-page":e(y),onOnCommentUpdate:e(w),onChangeCurrentPage:e(F)},null,8,["article-id","current-list","current-page","total-page","onOnCommentUpdate","onChangeCurrentPage"])])]),rightBox:p(()=>[o(e(pt),{author:e(d),time:e(_),tag:e(m)},null,8,["author","time","tag"]),o(e(et)),o(e(st),{ref:"referElement"},null,512),c("div",vt,[o(e($),{title:"\u76EE\u5F55 \u{1F530}"},{default:p(()=>[c("div",ft,[(C(!0),k(z,null,Y(e(i),(A,V)=>(C(),k("div",{key:V,style:he({padding:`10px 0 10px ${A.indent*20}px`}),onClick:H=>e(l)(A)},[c("a",Ct,I(A.title),1)],12,ht))),128))])]),_:1})])]),_:1},512)])}}}));var Et=R(kt,[["__scopeId","data-v-fb074ab4"]]);export{Et as default};
