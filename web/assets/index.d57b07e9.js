import{B as F}from"./BaseTitle.62ed6cfd.js";import{d as b}from"./default-avatar.7ca997ff.js";import{i as S,u as A,_ as T}from"./index.dfc6a663.js";import{l as H}from"./lodash.88cb4584.js";import{r as m,a6 as B,a9 as N,at as M,a7 as j,ao as z,c as D,o as u,f as i,g as t,F as k,i as I,k as s,h as d,U as E,_ as L,w as U,v as $,x as q,n as P,ad as V,t as C,Z as w}from"./vendor.e2990882.js";function R(){const a=m(!0),l=m(!1),c=m(),o=S(),r=A(),_=B(()=>o.messages),v=B(()=>o.userlist),n=m("");N(()=>{o.init(r.userId);const e=c.value;e.addEventListener("scroll",H.exports.throttle(function(){e.scrollHeight-e.scrollTop>e.clientHeight+200?l.value=!1:l.value=!0},100))}),M(()=>{const e=c.value;e.scrollTo(0,e.scrollHeight)}),j(o.messages,async()=>{const e=c.value;await z();const y=e.clientHeight,g=e.scrollHeight,x=()=>{const h=e.scrollTop;if(Math.ceil(h)>=g-y){a.value=!1;return}e.scrollTo(0,h+Math.ceil(g-h)/50),requestAnimationFrame(x)};(a.value||l.value)&&requestAnimationFrame(x)});function p(e){n.value=e}function f(){const e={action:3,chat:{senderId:r.userId,receiverId:-1,content:n.value,sign:0},uuid:-1,createrId:null};l.value=!0,o.send(e),n.value=""}return{messageBox:c,messages:_,user:r,sendValue:n,userlist:v,sendValueChangeValue:p,sendMessage:f}}const W=a=>($("data-v-5df3ab62"),a=a(),q(),a),Z={class:"chat"},G={class:"chat-box"},J={class:"chat-box-main"},K=W(()=>t("div",{class:"main-title"},"\u54B8\u8A00\u54B8\u8BED",-1)),O={class:"main-item-content"},Q={class:"main-input"},X=w("\u53D1\u9001 \u{1F680}"),Y={class:"chat-box-user"},ee={class:"user-title"},se=D({setup(a){const{messages:l,messageBox:c,user:o,sendValue:r,userlist:_,sendValueChangeValue:v,sendMessage:n}=R();return(p,f)=>(u(),i("div",Z,[t("div",G,[t("div",J,[K,t("ul",{ref_key:"messageBox",ref:c,class:"main-list"},[(u(!0),i(k,null,I(s(l),e=>(u(),i("li",{key:e.id,class:P(["main-item",s(o).userId==e.senderId?" self":""])},[d(s(V),{class:"main-avatar",size:36,round:"","object-fit":"cover",src:e.img_url?`http://112.74.108.218:8080/${e.img_url}`:s(b),"fallback-src":"/src/assets/image/bgc1.jpg"},null,8,["src"]),t("div",O,C(e.content),1)],2))),128))],512),t("div",Q,[d(s(E),{placeholder:"\u5728\u6B64\u8F93\u5165\u5185\u5BB9",type:"textarea",autosize:{maxRows:3,minRows:1},maxlength:500,value:s(r),onUpdateValue:s(v)},null,8,["value","onUpdateValue"]),d(s(L),{onClick:s(n)},{default:U(()=>[X]),_:1},8,["onClick"])])]),t("div",Y,[t("div",ee,[d(s(F),{title:`\u5F53\u524D\u5728\u7EBF ${s(_).size}`},null,8,["title"])]),(u(!0),i(k,null,I(s(_).values(),e=>(u(),i("div",{key:e.id,class:"user-item"},[d(s(V),{round:"","object-fit":"cover",src:e.imgUrl?`http://112.74.108.218:8080/${e.imgUrl}`:s(b),"fallback-src":"/src/assets/image/bgc1.jpg"},null,8,["src"]),w(" "+C(e.nick),1)]))),128))])])]))}});var ne=T(se,[["__scopeId","data-v-5df3ab62"]]);export{ne as default};
